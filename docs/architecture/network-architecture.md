# Сетевая архитектура проекта

## Обзор архитектуры

Проект развертывает отказоустойчивую веб-инфраструктуру в Yandex Cloud с использованием принципов высокой доступности и безопасности.

## Диаграмма сети

```
                                    Internet
                                        |
                                        |
                              ┌─────────────────┐
                              │  Load Balancer  │
                              │ 158.160.99.254  │
                              │    (External)   │
                              └─────────────────┘
                                        |
                              ┌─────────────────┐
                              │  Bastion Host   │
                              │ 158.160.99.254  │
                              │   (SSH Access)  │
                              └─────────────────┘
                                        |
                              ┌─────────────────┐
                              │   VPC Network   │
                              │   10.0.0.0/16   │
                              └─────────────────┘
                                        |
                    ┌───────────────────┼───────────────────┐
                    │                   │                   │
          ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
          │   Subnet A      │ │   Subnet B      │ │   Subnet C      │
          │  10.0.1.0/24    │ │  10.0.2.0/24    │ │  10.0.3.0/24    │
          │ ru-central1-a   │ │ ru-central1-b   │ │ ru-central1-c   │
          └─────────────────┘ └─────────────────┘ └─────────────────┘
                    │                   │                   │
          ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
          │  Web Server 1   │ │  Web Server 2   │ │ Monitoring/Log  │
          │   10.0.1.5      │ │   10.0.2.5      │ │   10.0.3.5      │
          │    (Nginx)      │ │    (Nginx)      │ │ Zabbix/ELK/etc  │
          └─────────────────┘ └─────────────────┘ └─────────────────┘
```

## Компоненты инфраструктуры

### 1. Внешние компоненты

#### Load Balancer (Application Load Balancer)
- **IP-адрес:** `158.160.99.254`
- **Назначение:** Распределение HTTP/HTTPS трафика между веб-серверами
- **Порты:** 80 (HTTP), 443 (HTTPS)
- **Health Checks:** Проверка доступности веб-серверов на порту 80
- **Алгоритм балансировки:** Round Robin

#### Bastion Host
- **Внешний IP:** `158.160.99.254`
- **Внутренний IP:** `10.0.1.4`
- **Назначение:** Безопасная точка входа для администрирования
- **Порты:** 22 (SSH)
- **Доступ:** Только по SSH ключам

### 2. Внутренние компоненты

#### Web Server 1
- **IP-адрес:** `10.0.1.5`
- **Зона доступности:** `ru-central1-a`
- **Подсеть:** `10.0.1.0/24`
- **Сервисы:** Nginx
- **Порты:** 80 (HTTP), 22 (SSH)

#### Web Server 2
- **IP-адрес:** `10.0.2.5`
- **Зона доступности:** `ru-central1-b`
- **Подсеть:** `10.0.2.0/24`
- **Сервисы:** Nginx
- **Порты:** 80 (HTTP), 22 (SSH)

#### Monitoring/Logging Server
- **IP-адрес:** `10.0.3.5`
- **Зона доступности:** `ru-central1-c`
- **Подсеть:** `10.0.3.0/24`
- **Сервисы:** 
  - Zabbix Server (порт 80, 10051)
  - Elasticsearch (порт 9200, 9300)
  - Kibana (порт 5601)
- **Порты:** 22 (SSH), 80 (HTTP), 5601 (Kibana), 9200 (Elasticsearch), 9300 (Elasticsearch Transport), 10051 (Zabbix)

## Сетевая конфигурация

### VPC (Virtual Private Cloud)
- **CIDR:** `10.0.0.0/16`
- **Регион:** `ru-central1`
- **Зоны доступности:** `ru-central1-a`, `ru-central1-b`, `ru-central1-c`

### Подсети

#### Subnet A (Web Server 1)
- **CIDR:** `10.0.1.0/24`
- **Зона:** `ru-central1-a`
- **Назначение:** Веб-сервер 1, Bastion Host

#### Subnet B (Web Server 2)
- **CIDR:** `10.0.2.0/24`
- **Зона:** `ru-central1-b`
- **Назначение:** Веб-сервер 2

#### Subnet C (Monitoring/Logging)
- **CIDR:** `10.0.3.0/24`
- **Зона:** `ru-central1-c`
- **Назначение:** Сервер мониторинга и логирования

### NAT Gateway
- **Назначение:** Обеспечение доступа в интернет для внутренних серверов
- **Подключение:** Ко всем приватным подсетям

## Группы безопасности

### Load Balancer Security Group
- **Входящий трафик:**
  - HTTP (80) - от любых адресов
  - HTTPS (443) - от любых адресов
- **Исходящий трафик:**
  - HTTP (80) - к веб-серверам
  - HTTPS (443) - к веб-серверам

### Bastion Host Security Group
- **Входящий трафик:**
  - SSH (22) - от любых адресов
- **Исходящий трафик:**
  - SSH (22) - к внутренним серверам
  - HTTP/HTTPS - для обновлений

### Web Servers Security Group
- **Входящий трафик:**
  - HTTP (80) - от Load Balancer
  - SSH (22) - от Bastion Host
- **Исходящий трафик:**
  - HTTP/HTTPS - для обновлений
  - Beats (5044) - к Elasticsearch

### Monitoring/Logging Security Group
- **Входящий трафик:**
  - HTTP (80) - от Load Balancer (Zabbix)
  - Kibana (5601) - от Load Balancer
  - Elasticsearch (9200) - от веб-серверов
  - Elasticsearch (9300) - внутренний транспорт
  - Zabbix (10051) - от агентов
  - SSH (22) - от Bastion Host
  - Beats (5044) - от веб-серверов
- **Исходящий трафик:**
  - HTTP/HTTPS - для обновлений

## Маршрутизация

### Таблицы маршрутизации

#### Публичная подсеть (Bastion Host)
- `0.0.0.0/0` → Internet Gateway
- `10.0.0.0/16` → Local

#### Приватные подсети (Web Servers, Monitoring)
- `0.0.0.0/0` → NAT Gateway
- `10.0.0.0/16` → Local

## Отказоустойчивость

### Высокая доступность
- Веб-серверы развернуты в разных зонах доступности
- Load Balancer автоматически перенаправляет трафик при отказе сервера
- Health checks обеспечивают мониторинг состояния серверов

### Резервирование
- Два веб-сервера для обработки HTTP запросов
- Автоматическое переключение трафика при недоступности сервера
- Мониторинг состояния всех компонентов через Zabbix

## Безопасность

### Сетевая изоляция
- Все внутренние серверы находятся в приватных подсетях
- Доступ к внутренним ресурсам только через Bastion Host
- Группы безопасности ограничивают сетевой трафик по принципу минимальных привилегий

### Аутентификация
- SSH доступ только по ключам
- Отключена аутентификация по паролям
- Уникальные SSH ключи для каждого сервера

### Мониторинг безопасности
- Логирование всех SSH подключений
- Мониторинг сетевого трафика через Zabbix
- Централизованный сбор логов в Elasticsearch

## Производительность

### Балансировка нагрузки
- Application Load Balancer распределяет запросы между веб-серверами
- Алгоритм Round Robin для равномерного распределения
- Health checks исключают недоступные серверы из балансировки

### Мониторинг производительности
- Zabbix мониторинг системных ресурсов
- Elasticsearch для анализа логов производительности
- Grafana дашборды для визуализации метрик

## Масштабирование

### Горизонтальное масштабирование
- Возможность добавления дополнительных веб-серверов
- Автоматическое включение новых серверов в балансировку
- Масштабирование мониторинга и логирования

### Вертикальное масштабирование
- Увеличение ресурсов существующих серверов
- Изменение типов виртуальных машин
- Добавление дискового пространства