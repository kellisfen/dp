---
# Переменные для серверов логирования
# Дипломный проект DevOps

# Настройки Elasticsearch
elasticsearch_version: "8.11.0"
elasticsearch_cluster_name: "diplom-logging-cluster"
elasticsearch_node_name: "{{ inventory_hostname }}"
elasticsearch_network_host: "0.0.0.0"
elasticsearch_http_port: 9200
elasticsearch_transport_port: 9300

# Настройки производительности Elasticsearch
elasticsearch_heap_size: "1g"
elasticsearch_config:
  cluster.name: "{{ elasticsearch_cluster_name }}"
  node.name: "{{ elasticsearch_node_name }}"
  path.data: /var/lib/elasticsearch
  path.logs: /var/log/elasticsearch
  network.host: "{{ elasticsearch_network_host }}"
  http.port: "{{ elasticsearch_http_port }}"
  transport.port: "{{ elasticsearch_transport_port }}"
  discovery.type: single-node
  xpack.security.enabled: false
  xpack.security.enrollment.enabled: false
  xpack.security.http.ssl.enabled: false
  xpack.security.transport.ssl.enabled: false

# Настройки JVM для Elasticsearch
elasticsearch_jvm_options:
  - "-Xms{{ elasticsearch_heap_size }}"
  - "-Xmx{{ elasticsearch_heap_size }}"
  - "-XX:+UseG1GC"
  - "-XX:G1HeapRegionSize=16m"
  - "-XX:+UseG1GC"
  - "-XX:+UnlockExperimentalVMOptions"
  - "-XX:+UseZGC"

# Настройки Kibana
kibana_version: "{{ elasticsearch_version }}"
kibana_server_port: 5601
kibana_server_host: "0.0.0.0"
kibana_elasticsearch_hosts: ["http://{{ elasticsearch_internal_ip }}:{{ elasticsearch_http_port }}"]

kibana_config:
  server.port: "{{ kibana_server_port }}"
  server.host: "{{ kibana_server_host }}"
  elasticsearch.hosts: "{{ kibana_elasticsearch_hosts }}"
  logging.appenders.file.type: file
  logging.appenders.file.fileName: /var/log/kibana/kibana.log
  logging.appenders.file.layout.type: json
  logging.root.level: info

# Настройки индексов
index_templates:
  - name: "nginx-logs"
    pattern: "nginx-*"
    settings:
      number_of_shards: 1
      number_of_replicas: 0
      refresh_interval: "5s"
  - name: "system-logs"
    pattern: "system-*"
    settings:
      number_of_shards: 1
      number_of_replicas: 0
      refresh_interval: "10s"
  - name: "application-logs"
    pattern: "app-*"
    settings:
      number_of_shards: 1
      number_of_replicas: 0
      refresh_interval: "5s"

# Настройки ретенции логов
log_retention_policy:
  nginx_logs: "30d"
  system_logs: "90d"
  application_logs: "60d"
  error_logs: "180d"

# Дополнительные порты для файрвола
additional_firewall_ports:
  - { port: "{{ elasticsearch_http_port }}", proto: "tcp", comment: "Elasticsearch HTTP", src: "10.0.0.0/8" }
  - { port: "{{ elasticsearch_transport_port }}", proto: "tcp", comment: "Elasticsearch Transport", src: "10.0.0.0/8" }
  - { port: "{{ kibana_server_port }}", proto: "tcp", comment: "Kibana" }

# Настройки мониторинга для ELK
monitoring_config:
  elasticsearch_monitoring: true
  kibana_monitoring: true
  log_level: "INFO"
  metrics_collection: true

# Настройки резервного копирования
backup_config:
  elasticsearch_snapshots: true
  snapshot_repository: "/opt/elasticsearch/backups"
  snapshot_schedule: "0 1 * * *"  # Каждый день в 1:00
  retention_days: "{{ backup_retention_days }}"

# Настройки безопасности
security_config:
  elasticsearch_auth: false  # Для простоты в дипломном проекте
  kibana_auth: false
  network_restrictions: true
  allowed_networks:
    - "10.0.0.0/8"
    - "127.0.0.1/32"