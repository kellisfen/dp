# Отчет о настройке системы мониторинга и логирования

## Обзор инфраструктуры

### Серверы
- **Bastion Server**: 158.160.114.114 (публичный IP)
- **Zabbix Server**: 10.0.4.15 (мониторинг)
- **Log Server**: 10.0.4.16 (сбор логов)
- **Web Server**: 10.0.4.17 (веб-приложение)

## Настроенные компоненты

### 1. Zabbix Server (10.0.4.15)
✅ **Статус**: Настроен и запущен

**Установленные компоненты:**
- Zabbix Server 6.0 LTS
- PostgreSQL 14 (база данных)
- Nginx (веб-сервер)
- Zabbix Agent 2

**Конфигурация:**
- База данных: PostgreSQL с пользователем `zabbix`
- Веб-интерфейс: доступен через Nginx
- Мониторинг: самомониторинг через Zabbix Agent 2

**Доступ:**
- Веб-интерфейс: http://10.0.4.15/zabbix/
- Логин: Admin / zabbix

### 2. Log Server (10.0.4.16)
✅ **Статус**: Настроен для сбора логов

**Установленные компоненты:**
- rsyslog (централизованный сбор логов)
- Docker & Docker Compose
- Zabbix Agent 2

**Конфигурация:**
- rsyslog настроен для приема UDP логов на порту 514
- Создан скрипт мониторинга логов `/usr/local/bin/log_monitor.sh`
- Автоматическая отправка метрик в Zabbix каждые 5 минут

**Мониторинг логов:**
- Подсчет ошибок (ERROR, CRITICAL, FATAL)
- Мониторинг размера логов
- Отслеживание последней активности

### 3. Web Server (10.0.4.17)
✅ **Статус**: Настроен с мониторингом

**Установленные компоненты:**
- Nginx (веб-сервер)
- Zabbix Agent 2

**Конфигурация:**
- rsyslog настроен для отправки логов на Log Server
- Создан скрипт мониторинга веб-сервера `/usr/local/bin/web_monitor.sh`
- Автоматический мониторинг каждые 2 минуты

**Мониторинг веб-сервера:**
- Статус nginx (активен/неактивен)
- Количество соединений
- Количество процессов nginx
- HTTP код ответа
- Время ответа сервера

## Настроенные метрики мониторинга

### Системные метрики (все серверы)
- Загрузка CPU
- Использование памяти
- Дисковое пространство
- Сетевая активность
- Количество процессов

### Специфические метрики

#### Log Server
- `log.errors` - количество ошибок в логах
- `log.size.mb` - размер логов в МБ
- `log.last.activity` - время последней активности
- `nginx.requests.last1000` - последние 1000 запросов nginx

#### Web Server
- `nginx.status` - статус nginx (1=активен, 0=неактивен)
- `nginx.connections` - количество соединений
- `nginx.processes` - количество процессов nginx
- `web.response.code` - HTTP код ответа
- `web.response.time` - время ответа

## Логирование

### Централизованный сбор логов
- **Log Server** настроен как центральный сервер логов
- **Web Server** отправляет логи на Log Server через rsyslog
- Логи сохраняются в `/var/log/remote/[hostname]/[program].log`

### Мониторинг логов
- Автоматический анализ логов на наличие ошибок
- Отправка метрик в Zabbix для создания алертов
- Мониторинг размера и активности логов

## Безопасность

### Сетевая безопасность
- Все серверы находятся в приватной сети
- Доступ только через Bastion Server
- Настроены Security Groups для ограничения доступа

### Аутентификация
- SSH доступ только по ключам
- Zabbix веб-интерфейс защищен паролем
- Отключена аутентификация по паролю для SSH

## Автоматизация

### Cron задачи
- **Log Server**: мониторинг логов каждые 5 минут
- **Web Server**: мониторинг веб-сервера каждые 2 минуты

### Скрипты мониторинга
- `/usr/local/bin/log_monitor.sh` - мониторинг логов
- `/usr/local/bin/web_monitor.sh` - мониторинг веб-сервера

## Рекомендации по дальнейшему развитию

### 1. Настройка алертов в Zabbix
- Создать триггеры для критических метрик
- Настроить уведомления по email/Telegram
- Добавить эскалацию алертов

### 2. Расширение мониторинга
- Добавить мониторинг базы данных PostgreSQL
- Настроить мониторинг производительности приложений
- Добавить мониторинг сетевого оборудования

### 3. Улучшение логирования
- Настроить ротацию логов
- Добавить парсинг и индексацию логов
- Создать дашборды для анализа логов

### 4. Резервное копирование
- Настроить бэкап конфигураций Zabbix
- Создать снапшоты дисков серверов
- Настроить репликацию базы данных

## Заключение

Система мониторинга и логирования успешно настроена и готова к эксплуатации. Все основные компоненты функционируют корректно:

- ✅ Zabbix Server работает и собирает метрики
- ✅ Централизованное логирование настроено
- ✅ Автоматический мониторинг веб-сервера активен
- ✅ Безопасность обеспечена через приватную сеть и Bastion

Система обеспечивает полный контроль над состоянием инфраструктуры и позволяет оперативно реагировать на возникающие проблемы.